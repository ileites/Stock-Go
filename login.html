<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danny's Burger - Login</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Script de Firebase con m√≥dulos -->
    <script type="module">
        // Importar los servicios que necesitamos
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js';

        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAQYm3bnopb82-l_0zpejACXCz3xFD0wys",
            authDomain: "stock-go-e5919.firebaseapp.com",
            projectId: "stock-go-e5919",
            storageBucket: "stock-go-e5919.firebasestorage.app",
            messagingSenderId: "1076533357182",
            appId: "1:1076533357182:web:6d432216677def2edfc62f",
            measurementId: "G-D46G6XMEQY"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Referencia al formulario
        document.getElementById('loginForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            try {
                // Intentar login
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Leer rol desde Firestore
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const role = userData.role || 'user';

                    // Guardar en sesi√≥n
                    sessionStorage.setItem('userRole', role);
                    sessionStorage.setItem('userName', userData.name || 'Usuario');
                    sessionStorage.setItem('userEmail', email);

                    // Redirigir seg√∫n rol
                    if (role === 'admin') {
                        window.location.href = 'index.html';
                    } else {
                        window.location.href = 'user.html';
                    }
                } else {
                    showAlert('danger', '‚ùå No tienes permisos. Contacta al administrador.');
                }
            } catch (error) {
                let message = 'Error al iniciar sesi√≥n.';
                switch (error.code) {
                    case 'auth/user-not-found':
                        message = 'No se encontr√≥ una cuenta con ese correo.';
                        break;
                    case 'auth/wrong-password':
                        message = 'Contrase√±a incorrecta.';
                        break;
                    case 'auth/invalid-credential':
                        message = 'Credenciales inv√°lidas.';
                        break;
                    default:
                        message = error.message;
                }
                showAlert('danger', '‚ùå ' + message);
            }
        });

        // Funci√≥n para mostrar alertas
        window.showAlert = function(type, message) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            const container = document.querySelector('.content') || document.body;
            container.insertBefore(alert, container.firstChild);
            setTimeout(() => alert.remove(), 5000);
        }

        // Part√≠culas y tema (van en otro script)
    </script>
</head>
<body data-theme="dark">
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo-circle">
                    <span class="burger-icon">üçî</span>
                </div>
                <div>
                    <h1>DANNY'S</h1>
                    <div class="subtitle">BURGER ‚Ä¢ 2024</div>
                </div>
            </div>
            <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è</button>
        </div>

        <div class="content">
            <div class="section active" id="login">
                <h2>¬°Bienvenido al Burger World!</h2>
                <div class="vintage-decoration">‚óÜ ‚óá ‚óÜ</div>
                
                <form id="loginForm" class="form-group">
                    <div class="modal-form-group">
                        <label for="email">Correo Electr√≥nico:</label>
                        <input type="email" id="email" placeholder="Ingresa tu email" required>
                    </div>
                    <div class="modal-form-group">
                        <label for="password">Contrase√±a:</label>
                        <input type="password" id="password" placeholder="Ingresa tu contrase√±a" required>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-gold">Entrar al Burger World</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="particles"></div>
    
    <!-- Otros scripts (tema, part√≠culas) -->
    <script>
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // Part√≠culas (igual que antes)
        function createParticles() {
            const container = document.getElementById('particles');
            if (!container) return;
            const count = window.innerWidth > 768 ? 20 : 8;
            // ... (c√≥digo de part√≠culas igual al anterior)
        }
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
        });
    </script>
</body>
</html>