<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chat de IAs estilo WhatsApp</title>
<style>
/* Reset básico */
* { box-sizing: border-box; margin: 0; padding: 0; }

/* Fondo general */
body { 
    font-family: 'Helvetica', Arial, sans-serif; 
    background-color: #e5ddd5; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    height: 100vh;
}

/* Contenedor principal */
.chat-container {
    width: 400px;
    max-width: 95%;
    height: 600px;
    background-color: #fff;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    overflow: hidden;
}

/* Barra superior */
.chat-header {
    background-color: #075e54;
    color: #fff;
    padding: 15px;
    font-weight: bold;
    text-align: center;
    font-size: 18px;
}

/* Área de mensajes */
#chat {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* Burbuja de mensaje */
.mensaje {
    padding: 8px 12px;
    border-radius: 18px;
    max-width: 70%;
    word-wrap: break-word;
    line-height: 1.4;
}

/* IA-1 izquierda */
.IA-1 {
    background-color: #dcf8c6;
    color: #000;
    align-self: flex-start;
    border-bottom-left-radius: 0;
}

/* IA-2 derecha */
.IA-2 {
    background-color: #34b7f1;
    color: #fff;
    align-self: flex-end;
    border-bottom-right-radius: 0;
}

/* Barra inferior */
.chat-footer {
    display: flex;
    padding: 10px;
    background-color: #f0f0f0;
    gap: 5px;
    align-items: center;
}

/* Input y botones */
#textoEntrada {
    flex: 1;
    padding: 10px;
    border-radius: 20px;
    border: 1px solid #ccc;
    outline: none;
    font-size: 14px;
}

#pdfFile {
    display: none; /* oculto, se activa con botón */
}

button {
    background-color: #075e54;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    transition: 0.2s;
}

button:hover {
    background-color: #128c7e;
}

/* Botón para cargar PDF */
#cargarPDF {
    background-color: #25d366;
}

#cargarPDF:hover {
    background-color: #1ebe5d;
}
</style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">IA Chat</div>

    <div id="chat"></div>

    <div class="chat-footer">
        <input type="text" id="textoEntrada" placeholder="Escribí un mensaje o procesá un PDF...">
        <button id="cargarPDF">PDF</button>
        <button id="enviarMensaje">Enviar</button>
        <input type="file" id="pdfFile">
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.worker.min.js';

let contexto = "";
const chatDiv = document.getElementById('chat');

function mostrarMensaje(ia,mensaje){
    const div = document.createElement("div");
    div.className = "mensaje " + ia;
    chatDiv.appendChild(div);

    let texto = "";
    for(const palabra of mensaje.split(" ")){
        texto += palabra + " ";
        div.textContent = texto;
        chatDiv.scrollTop = chatDiv.scrollHeight;
    }
}

// PDF
document.getElementById('cargarPDF').onclick = () => document.getElementById('pdfFile').click();
document.getElementById('pdfFile').onchange = async (e) => {
    const file = e.target.files[0];
    if(!file) return;

    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
    let text = "";
    for(let i=1;i<=pdf.numPages;i++){
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(item=>item.str).join(" ") + "\n\n";
    }
    document.getElementById('textoEntrada').value = text.length>3000?text.slice(0,3000):text;
}

// Enviar mensaje
document.getElementById('enviarMensaje').onclick = async () => {
    const text = document.getElementById('textoEntrada').value.trim();
    if(!text) return;
    document.getElementById('textoEntrada').value = "";

    // Mostrar en chat como IA-1 (usuario)
    mostrarMensaje("IA-1", text);

    // Aquí podes llamar al backend y agregar lógica para que IA-2 responda
    // Ejemplo demo:
    setTimeout(()=>mostrarMensaje("IA-2","Respuesta automática de IA-2 en 30-40 palabras..."),500);
}
</script>
</body>
</html>
